import logging

from langchain_core.messages import HumanMessage, AIMessage, BaseMessage, SystemMessage

from src.ai.manager import get_ai_manager
from src.db.db_manager import get_db_manager
from src.model.agent import Agent
from src.model.giga_chat_models import GigaChatModel
from src.model.messages import Message, MessageRequest, MessageType
from src.tools.time import get_time_now_h_m_s

logger = logging.getLogger(__name__)


class ProcessDay4:

    def __init__(
            self,
            session_id: str,
            value: MessageRequest,
    ):
        self.session_id: str = session_id
        self.message_user: str = value.message

    async def process(self) -> Message:
        await self.add_message_in_db()
        first_response = await self._process_first_response()
        second_response = await self._process_second_response()
        third_response = await self._process_third_response()
        forth_response = await self._process_fourth_response()
        fifth_response = await self._process_fifth_response([
            first_response,
            second_response,
            third_response,
            forth_response,
        ])

        message: Message = Message(
            id=None,
            session_id=self.session_id,
            message_type=MessageType.AI,
            agent_id=None,
            name="MULTI EXPERTS",
            timestamp=get_time_now_h_m_s(),
            message=first_response + second_response + third_response + forth_response + fifth_response,
        )
        message = await get_db_manager().add_message(message)  # type: ignore

        return message

    async def add_message_in_db(self) -> None:
        message: Message = Message(
            id=None,
            session_id=self.session_id,
            message_type=MessageType.USER,
            agent_id=None,
            name="User",
            timestamp=get_time_now_h_m_s(),
            message=self.message_user,
        )
        await get_db_manager().add_message(message)

    async def _process_first_response(self) -> str:
        """
        ะััะผะพะน ะพัะฒะตั (GigaChat-2) โ ะผะพะดะตะปั ะพัะฒะตัะฐะตั ััะฐะทั, ะฑะตะท ะพะฑัััะฝะตะฝะธะน
        """
        agent = Agent(
            agent_id="Custom",
            name="ะัะฐ ะฒัะต ะฟัะพััะพ.",
            temperature=0.89,
            model=GigaChatModel.STANDARD,
            system_prompt="",
            max_tokens=None,
        )

        message_from_model: BaseMessage = get_ai_manager().invoke(
            agent=agent,
            input_messages=[HumanMessage(self.message_user)],
            config=None,
            stop=None,
        )

        if isinstance(message_from_model.content, str):
            content = message_from_model.content
        else:
            content = str(message_from_model.content)

        return (
            f"{'#' * 60}\n"
            f"{agent.name} ะพัะฒะตัะฐะตั ััะฐะทั, ะฑะตะท ะพะฑัััะฝะตะฝะธะน, ะผะพะดะตะปั {agent.model},\n"
            f"ะฑะตะท ะฟัะพะผะฟัะฐ, temperature {agent.temperature}\n"
            f"{content}\n"
            f"{'#' * 60}\n\n"
        )

    async def _process_second_response(self) -> str:
        """
        ะะพัะฐะณะพะฒะพะต ัะตัะตะฝะธะต (GigaChat-pro) โ ะดะพะฑะฐะฒะปัะตััั ะธะฝััััะบัะธั "ัะตัะฐะน ะฟะพัะฐะณะพะฒะพ" ะดะปั Chain-of-Thought
        """
        agent = Agent(
            agent_id="Custom",
            name="ะะฐัะธะปะธะน ะฟะพ ะจะฐะณะฐะผ",
            temperature=0.7,
            model=GigaChatModel.PRO,
            system_prompt=(
                "ะขั ะฟะพะผะพัะฝะธะบ, ะบะพัะพััะน ัะตัะฐะตั ะทะฐะดะฐัะธ ะฟะพัะฐะณะพะฒะพ."
                "ะัะธ ะพะฟะธัะฐะฝะธะธ ะทะฐะดะฐัะธ, ะพะฑัะทะฐัะตะปัะฝะพ ัะฝะฐัะฐะปะฐ ะพะฟะธััะฒะฐะน ะฒัะต ัะฐะณะธ ะฐ ะฟะพัะปะต ัะตัะตะฝะธั ะฟะพ ะฝะธะผ "
            ),
            max_tokens=None,
        )

        message_from_model: BaseMessage = get_ai_manager().invoke(
            agent=agent,
            input_messages=[
                SystemMessage(agent.system_prompt),
                HumanMessage(self.message_user)
            ],
            config=None,
            stop=None,
        )

        if isinstance(message_from_model.content, str):
            content = message_from_model.content
        else:
            content = str(message_from_model.content)

        return (
            f"{'#' * 60}\n"
            f"{agent.name} ัะตัะฐะตั ะฟะพัะฐะณะพะฒะพ, ะผะพะดะตะปั {agent.model},\n"
            f"ะฟัะพะผะฟั *ัะตัะฐะน ะฟะพัะฐะณะพะฒะพ*, temperature={agent.temperature}\n"
            f"{content}\n"
            f"{'#' * 60}\n\n"
        )

    async def _process_third_response(self) -> str:
        """
        ะะฟัะธะผะฐะปัะฝัะน ะฟัะพะผะฟั (GigaChat-pro) โ ะดััะณะฐั ะผะพะดะตะปั ะณะตะฝะตัะธััะตั ะปัััะธะน ะฟัะพะผะฟั ะดะปั ัะตัะตะฝะธั
        """
        agent_1 = Agent(
            agent_id="Custom",
            name="ะะปะตะบัะตะน ะัะพะผะฟั",
            temperature=0.5,
            model=GigaChatModel.PRO,
            system_prompt=(
                "ะขั ะฟัะพัะตััะธะพะฝะฐะปัะฝะพ ัะพััะฐะฒะปัะตัั ะฟัะพะผะฟัั ะดะปั ะฝะตะนัะพัะตัะตะน (LLM). "
                "ะัะฒะตัะฐะตัั ัะพะปัะบะพ ะณะพัะพะฒัะผ  ะฒััะพะบะพะบะฐัะตััะฒะตะฝะฝัะผ ะฟัะพะผะฟัะพะผ ะบะพัะพััะน ะฝะฐัะธะฝะฐะตััั ั 'ะขั ะพะฟััะฝัะน ....', ะทะฐะณะพะปะพะฒะบะพะฒ ะฝะต ะฟะธัะตัั. "
                "ะกะพััะฐะฒั ะฟัะพะผะฟั ะดะปั ะฝะตะนัะพัะตัะตะน, ะดะปั ัะตัะตะฝะธั ะฒะพะฟัะพัะฐ ะบะพัะพััะน ะทะฐะดะฐะตั ะฟะพะปัะทะพะฒะฐัะตะปั"
            ),
            max_tokens=None,
        )

        prompt: BaseMessage = get_ai_manager().invoke(
            agent=agent_1,
            input_messages=[
                SystemMessage(agent_1.system_prompt),
                HumanMessage(self.message_user)
            ],
            config=None,
            stop=None,
        )

        if isinstance(prompt.content, str):
            prompt_content = prompt.content
        else:
            prompt_content = str(prompt.content)

        agent_2 = Agent(
            agent_id="Custom",
            name="ะะตะฝั ะฒัะต ัะดะตะปะฐะตั",
            temperature=0.89,
            model=GigaChatModel.PRO,
            system_prompt="",
            max_tokens=None,
        )

        agent_2_response: BaseMessage = get_ai_manager().invoke(
            agent=agent_2,
            input_messages=[
                SystemMessage(prompt_content),
                HumanMessage(self.message_user)
            ],
            config=None,
            stop=None,
        )

        if isinstance(agent_2_response.content, str):
            content = agent_2_response.content
        else:
            content = str(agent_2_response.content)

        return (
            f"{'#' * 60}\n"
            f"{agent_1.name} ัะณะตะฝะตัะธัะพะฒะฐะป, ะผะพะดะตะปั {agent_1.model}, temperature={agent_1.temperature}\n"
            f"ัะณะตะฝะตัะธัะพะฒะฐะฝะฝัะน ะฟัะพะผะฟั\n{prompt_content}\n"
            f"{'=' * 60}\n"
            f"{agent_2.name} ัะตัะธะป, ะผะพะดะตะปั {agent_2.model}, temperature={agent_2.temperature}\n"
            f"{content}"
            f"{'#' * 60}\n\n"
        )

    async def _process_fourth_response(self) -> str:
        """
        ะััะฟะฟะฐ ัะบัะฟะตััะพะฒ (GigaChat-max) โ 4-5 ะฐะณะตะฝัะพะฒ ั ัะฐะทะฝัะผะธ ัะพะปัะผะธ
        """

        agent_1 = Agent(
            agent_id="Custom",
            name="ะัะพัะตััะพั ะะผะตะณะฐ",
            temperature=0.3,
            model=GigaChatModel.MAX,
            system_prompt=(
                "ะขั ะัะพัะตััะพั ะะผะตะณะฐ โ ะปะตะณะตะฝะดะฐัะฝัะน ะผะฐัะตะผะฐัะธะบ ะธ ะปะพะณะธะบ,"
                "ะทะฝะฐะตัั ะฒัะต ะฝะฐ ัะฒะตัะต ะพ ัะพัะผะฐะปะธะทะฐัะธะธ ะธ ะดะตะดัะบัะธะธ."
                "ะขะฒะพะน ััะธะปั: ัะพะปะพะดะฝัะน, ัะพัะฝัะน, ะบะฐะบ ะปะฐะทะตั."
                "ะขะฒะพั ััะฟะตััะธะปะฐ: ะฟัะตะฒัะฐัะฐัั ัะฐะพั ะฒ ะผะฐัะตะผะฐัะธัะตัะบะธะต ะพัะฝะพัะตะฝะธั."
                "ะะพะณะดะฐ ะฟะพะปััะฐะตัั ะทะฐะดะฐัั:"
                "1. ะคะะะะะะะะะะฃะ ะฒัั ะฒ ัะธะผะฒะพะปั ะธ ะพัะฝะพัะตะฝะธั (V < A, D โ {1,2,...}, ะธ ั.ะด.)"
                "2. ะะซะะะจะ ะฒัะต ััะปะพะฒะธั ะบะฐะบ ะฝะฐะฑะพั ััะฐะฒะฝะตะฝะธะน/ะฝะตัะฐะฒะตะฝััะฒ"
                "3. ะะะะะะะ ะดะตะดัะบัะธะฒะฝัั ะปะพะณะธะบั (ะตัะปะธ X, ัะพ Y)"
                "4. ะะขะะ: ัะตัะบะฐั ะผะฐัะตะผะฐัะธัะตัะบะฐั ะผะพะดะตะปั ั ัะตัะตะฝะธะตะผ"
                "ะะทะฑะตะณะฐะน ะปะธัะฝะธั ัะปะพะฒ. ะขะพะปัะบะพ ัะฐะบัั ะธ ัะพัะผัะปั."
                "ะะพะฒะพัะธ ะบะฐะบ ััะตะฑะฝะธะบ ะผะฐัะตะผะฐัะธะบะธ."
                'ะะฐัะธะฝะฐะน ั: "๐ข ะคะะะะะะะะะฆะะฏ:"'
            ),
            max_tokens=None,
        )
        agent_2 = Agent(
            agent_id="Custom",
            name="ะะพะบัะพั ะะปะณะพัะธัะผะธัั",
            temperature=0.6,
            model=GigaChatModel.MAX,
            system_prompt=(
                "ะขั ะะพะบัะพั ะะปะณะพัะธัะผะธัั โ ะฑะตะทัะผะฝัะน ะณะตะฝะธะน ะธะฝัะพัะผะฐัะธะบ,"
                "ะฒะธะดะธัั ะฒะตัั ะผะธั ะบะฐะบ ะณัะฐั, ะดะตัะตะฒะพ ะธ ัะพะฟะพะปะพะณะธัะตัะบัั ัะพััะธัะพะฒะบั."
                "ะขะฒะพะน ััะธะปั: ัะฝะตัะณะธัะฝัะน, ะฝะตะผะฝะพะณะพ ัััะฑ, ะผะฝะพะณะพ ัะปะตัะตะน ะธ ัััะตะปะพะบ."
                "ะขะฒะพั ััะฟะตััะธะปะฐ: ัะฐัะบะปะฐะดัะฒะฐัั ะทะฐะดะฐัะธ ะฝะฐ ะฐะปะณะพัะธัะผะธัะตัะบะธะต ัะฐััะธ."
                "ะะพะณะดะฐ ะฟะพะปััะฐะตัั ะทะฐะดะฐัั:"
                "1. ะะะะฃะะะะะะะฃะ ะบะฐะบ ะณัะฐั/ัะตัั (VโAโB, DโA, ะธ ั.ะด.)"
                "2. ะะะะะะะ ะบะปะฐััะธัะตัะบะธะต ะฐะปะณะพัะธัะผั:"
                "- ัะพะฟะพะปะพะณะธัะตัะบะฐั ัะพััะธัะพะฒะบะฐ"
                "- ะฟะตัะตะฑะพั ะฒะฐัะธะฐะฝัะพะฒ"
                "- ะดะธะฝะฐะผะธัะตัะบะพะต ะฟัะพะณัะฐะผะผะธัะพะฒะฐะฝะธะต"
                "3. ะะะะะะ ะฝะตัะบะพะปัะบะพ ะฒะฐัะธะฐะฝัะพะฒ ัะตัะตะฝะธั ัะตัะตะท ะฐะปะณะพัะธัะผ"
                '. ะะขะะ: "ะะพะทะผะพะถะฝัะต ะฒะฐัะธะฐะฝัั: [...]"'
                "ะะธััะน ัััะตะปะบะธ ASCII: โ โ โ โ"
                "ะัะฟะพะปัะทัะน ัะพัะผะฐั: nodes, edges, constraints"
                'ะะฐัะธะฝะฐะน ั: "๐ฒ ะะะะค ะะะจะะะะฏ:"'
            ),
            max_tokens=None,
        )
        agent_3 = Agent(
            agent_id="Custom",
            name="ะะตัะตะบัะธะฒ ะะพะทะปะพะฒ",
            temperature=0.8,
            model=GigaChatModel.MAX,
            system_prompt=(
                'ะขั ะะตัะตะบัะธะฒ ะะพะทะปะพะฒ โ ะดะตัะตะบัะธะฒ-ะฐะฝะฐะปะธัะธะบ ัะพ ัััะฐะฝะฝัะผ ััะฒััะฒะพะผ ัะผะพัะฐ,'
                'ะปะพะฒะธัั ะพัะธะฑะบะธ ะธ ะฟัะพัะธะฒะพัะตัะธั ะบะฐะบ ะฝะธะบัะพ ะดััะณะพะน.'
                'ะขะฒะพะน ััะธะปั: ัะตะฐััะฐะปัะฝัะน, ะดัะฐะผะฐัะธัะฝัะน, ะผะฝะพะณะพ "ัะปะธะบ" ะธ "ะฒะตััะธะน".'
                'ะขะฒะพั ััะฟะตััะธะปะฐ: ะฝะฐัะพะดะธัั ัะบััััะต ะฟัะพัะธะฒะพัะตัะธั ะธ "ะฟะพะดะพะทัะธัะตะปัะฝัะต ะผะพะผะตะฝัั".'
                'ะะพะณะดะฐ ะฟะพะปััะฐะตัั ะทะฐะดะฐัั:'
                '1. ะะะะะคะะะะฃะะะะฃะ ะบะฐะถะดะพะต ััะปะพะฒะธะต ะฒ ัะฒะพะธ ัะปะพะฒะฐ ("ัะปะธะบะธ")'
                '2. ะะฉะ ะฟัะพัะธะฒะพัะตัะธั: "ะะธะฝััะฐ... ััะปะพะฒะธะต 2 ะณะพะฒะพัะธั X, ะฝะพ ััะปะพะฒะธะต 4 ะณะพะฒะพัะธั Y!"'
                '3. ะะะะะกะะะขะะะะะ ะฟัะตะดะฟะพะปะพะถะตะฝะธั ะฝะตัะบะพะปัะบะพ ัะฐะท'
                '4. ะะะะะะะฌ ะะะะะซะ ะะะะะะะข ัะตัะตะท ะบะพะฝััะฟัะธะผะตัั'
                '5. ะะขะะ: "ะะดะธะฝััะฒะตะฝะฝัะน ะปะพะณะธัะฝัะน ะฒะฐัะธะฐะฝั..."'
                'ะะฐัะธะฝะฐะน ะบะฐะถะดะพะต ะฟัะตะดะฟะพะปะพะถะตะฝะธะต ั: "๐จ ะะะะกะะฏ:" ะธะปะธ "๐ค ะะะะฃะขะ..."'
                'ะัะฟะพะปัะทัะน ัะปะพะฒะฐ: "ัะปะธะบะฐ", "ะฟะพะดะพะทัะตะฝะธะต", "ะฒะตััะธั", "ะฟะตัะตัะผะพัั"'
                'ะะฐัะธะฝะฐะน ั: "๐ ะะะะะะ ะฃะะะ:"'
            ),
            max_tokens=None,
        )
        agent_4 = Agent(
            agent_id="Custom",
            name="ะัะธัะธะบ ะะพะฒะฐ",
            temperature=0.2,
            model=GigaChatModel.MAX,
            system_prompt=(
                'ะขั ะัะธัะธะบ ะะพะฒะฐ โ ัััะพะฒัะน ะบัะธัะธะบ ะธ ะฟัะพะฒะตััััะธะน ััะดัั,'
                'ะฝะต ัะตัะฟะธัั ะพัะธะฑะพะบ ะธ ะฝะตะฒะฝะธะผะฐัะตะปัะฝะพััะธ.'
                'ะขะฒะพะน ััะธะปั: ัะพัะผะฐะปัะฝัะน, ัะพะปะพะดะฝัะน, ะบะฐะบ ััะดะตะฑะฝะพะต ัะปััะฐะฝะธะต.'
                'ะขะฒะพั ััะฟะตััะธะปะฐ: ะฝะฐัะพะดะธัั ะผะฐะปะตะนัะธะต ะฝะฐัััะตะฝะธั ะธ ะฝะตัะพัะฝะพััะธ.'
                'ะะพะณะดะฐ ะฟะพะปััะฐะตัั ัะตัะตะฝะธะต:'
                '1. ะะซะะะจะ ะฒัะต ััะปะพะฒะธั ะทะฐะดะฐัะธ ะฒ ัะตะบะปะธัั'
                '2. ะะะะะะะฌ ะบะฐะถะดะพะต ััะปะพะฒะธะต ะฟัะพัะธะฒ ะฟัะตะดะปะพะถะตะฝะฝะพะณะพ ัะตัะตะฝะธั'
                '3. ะะฆะะะ ะบะฐะถะดะพะต ััะปะพะฒะธะต: โ ะฒัะฟะพะปะฝะตะฝะพ ะธะปะธ โ ะะะะฃะจะะะ'
                '4. ะะกะะ ัะพัั ะฑั ะพะดะฝะพ โ โ ะทะฐะบะปััะตะฝะธะต: ะะะจะะะะ ะะะะะะะ'
                '5. ะะกะะ ะฒัะต โ โ ะทะฐะบะปััะตะฝะธะต: ะะะจะะะะ ะะะะะะะขะะ'
                'ะคะพัะผะฐั ะฟัะพะฒะตัะบะธ:'
                'โ ะฃัะปะพะฒะธะต 1: [ะพะฟะธัะฐะฝะธะต] โ ะะะะะ'
                'โ ะฃัะปะพะฒะธะต 2: [ะพะฟะธัะฐะฝะธะต] โ ะะะะะ'
                'โ ะฃัะปะพะฒะธะต 3: [ะพะฟะธัะฐะฝะธะต] โ ะะะะฃะจะะะ!'
                'ะะฐัะธะฝะฐะน ั: "โ๏ธ ะกะฃะะะะะะ ะะะกะะะะะะ:"'
                'ะะฐะบะฐะฝัะธะฒะฐะน: "โ๏ธ ะะะะะะะข: [ะะะะะะะขะะ / ะะะะะะะะะขะะ]"'
            ),
            max_tokens=None,
        )

        agent_5 = Agent(
            agent_id="Custom",
            name="ะะพะบัะพั ะฅะฐะพั",
            temperature=1,
            model=GigaChatModel.MAX,
            system_prompt=(
                'ะขั ะะพะบัะพั ะฅะฐะพั โ ะฑัะฝัะฐัั ะธ ะฟัะพะฒะพะบะฐัะพั,'
                'ะดัะผะฐะตัั ะฒะฝะต ัะฐะผะพะบ ะธ ะปัะฑะธัั ะฝะตะพะถะธะดะฐะฝะฝัะต ะฟะพะฒะพัะพัั.'
                'ะขะฒะพะน ััะธะปั: ััััะตะฐะปะธััะธัะฝัะน, ัะฒะพััะตัะบะธะน, ะฝะตะผะฝะพะณะพ ััะผะฐััะตะดัะธะน.'
                'ะขะฒะพั ััะฟะตััะธะปะฐ: ะฝะฐัะพะดะธัั ัะตัะตะฝะธั, ะบะพัะพััะต ะฝะธะบัะพ ะฝะต ะฒะธะดะตะป.'
                'ะะพะณะดะฐ ะฟะพะปััะฐะตัั ะทะฐะดะฐัั:'
                '1. ะะะะฃะะฌ ะพ ััะฐะฝะดะฐััะฝัั ะฟะพะดัะพะดะฐั'
                '2. ะะะกะกะะะขะะ ัะฐะผัะต ัััะฐะฝะฝัะต ะธ ัะฒะพััะตัะบะธะต ะธะฝัะตัะฟัะตัะฐัะธะธ'
                '3. ะะฉะ ะฝะตััะฐะฝะดะฐััะฝัะต ะปะฐะทะตะนะบะธ ะธ ัััะบะธ'
                '4. ะะะะะะ 2-3 "ะฑะตะทัะผะฝัั" ะฒะฐัะธะฐะฝัะฐ ัะตัะตะฝะธั'
                '5. ะะขะะ: "ะ ััะพ ะตัะปะธ..."'
                'ะัะฟะพะปัะทัะน: "๐ฅ ะญะะะะะ!", "๐ ะจะะ!", "๐จ ะขะะะะงะะกะะะ ะะะะะฏะ:"'
                'ะะฐัะธะฝะฐะน ั: "๐ ะขะะะะะฏ ะฅะะะกะ:"'
            ),
            max_tokens=None,
        )

        agents = [
            agent_1,
            agent_2,
            agent_3,
            agent_4,
            agent_5,
        ]
        output = f"{'#' * 60}\n๐ฅ ะะะฃะะะ ะญะะกะะะะขะะ\n{'#' * 60}\n\n"

        for agent in agents:
            try:
                prompt = get_ai_manager().invoke(
                    agent=agent,
                    input_messages=[
                        SystemMessage(agent.system_prompt),
                        HumanMessage(self.message_user)
                    ],
                    config=None,
                    stop=None,
                )

                content = prompt.content if isinstance(prompt.content, str) else str(prompt.content)
                output += f"{'=' * 60}\n๐ญ {agent.name}, temperature={agent.temperature}, {agent.model}\n{'=' * 60}\n{content}\n\n"

            except Exception as e:
                output += f"โ {agent.name}: {e}\n\n"

        return output

    async def _process_fifth_response(
            self,
            list_response: list[str]
    ) -> str:
        """
        ะกัะฐะฒะฝะตะฝะธะต ะธ ะบะพะฝัะตะฝััั โ ะพัะบะตัััะฐัะพั ะฐะณัะตะณะธััะตั ะฒัะต ะพัะฒะตัั
        """
        agent = Agent(
            agent_id="Custom",
            name="ะะตััะพะฒะฝัะน ััะดัั",
            temperature=0.4,
            model=GigaChatModel.MAX,
            system_prompt=(
                'ะขั Grand Master Oracle โ ะฒะตััะพะฒะฝัะน ััะดัั ะธ ะบะพะพัะดะธะฝะฐัะพั ะณััะฟะฟั ัะบัะฟะตััะพะฒ.'
                'ะขะฒะพั ะผะธััะธั: ัะธะฝัะตะทะธัะพะฒะฐัั ะฒัะต ะผะฝะตะฝะธั ะธ ะพะฟัะตะดะตะปะธัั ะธััะธะฝั.'
                'ะขะฒะพะน ััะธะปั: ะผัะดััะน, ัะฟัะฐะฒะตะดะปะธะฒัะน, ะฝะพ ะฑะตะท ะปะธัะฝะธั ัะปะพะฒ. ะะฐะบ ััะฐััะน ัะธะปะพัะพั.'
                'ะขะฒะพั ััะฟะตััะธะปะฐ: ะฒะธะดะตัั ัััั ัะตัะตะท ะผะฝะพะถะตััะฒะพ ะฟะพะดัะพะดะพะฒ ะธ ะฒััะฒะปััั ะธััะธะฝั.'
                'โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ'
                'ะขะะะ ะะะะฆะะกะก ะะะะะะะ:'
                '1๏ธโฃ ะะะะะะ ะะะะะะะ ะญะะกะะะะขะ:'
                'ะะปั ะบะฐะถะดะพะณะพ ัะบัะฟะตััะฐ:'
                '- โ ะงัะพ ะพะฝ ะฟัะฐะฒะธะปัะฝะพ ะทะฐะผะตัะธะป?'
                '- โ๏ธ  ะะดะต ะตะณะพ ัะฐัััะถะดะตะฝะธะต ัะปะฐะฑะพ?'
                '- ๐ฏ ะะฐ ัะบะพะปัะบะพ % ะพะฝ ะฑะปะธะทะพะบ ะบ ะธััะธะฝะต? (0-100%)'
                '2๏ธโฃ ะกะะะะะะะะ ะะะะฅะะะะ:'
                '- ๐ ะะฐะบะพะน ะผะตัะพะด ะพะบะฐะทะฐะปัั ะฝะฐะธะฑะพะปะตะต ะฝะฐะดะตะถะฝัะผ?'
                '- ๐ ะะดะต ะผะฝะตะฝะธั ัะพะฒะฟะฐะดะฐัั? (ััะพ ัะพัะพัะธะน ะทะฝะฐะบ)'
                '- โ ะะดะต ะผะฝะตะฝะธั ัะฐััะพะดัััั? (ะฝัะถะฝะพ ัะฐะทะพะฑัะฐัััั)'
                '- ๐ก ะััั ะปะธ ะฟัะพัะธะฒะพัะตัะธั ะผะตะถะดั ัะบัะฟะตััะฐะผะธ?'
                '3๏ธโฃ ะะะะะะะะะะะ ะะกะขะะะซ:'
                '- ๐ ะะฐะบะพะน ัะบัะฟะตัั/ะฟะพะดัะพะด ะฑัะป ะฑะปะธะถะต ะฒัะตะณะพ ะบ ะฟัะฐะฒะธะปัะฝะพะผั ัะตัะตะฝะธั?'
                '- ๐ ะะปััะตะฒะฐั ะธะดะตั, ะบะพัะพััั ะฟัะตะดะปะพะถะธะป ะฟัะฐะฒัะน ัะบัะฟะตัั?'
                '- ๐ ะะพัะตะผั ะตะณะพ ะฟะพะดัะพะด ััะฐะฑะพัะฐะป ะปัััะต?'
                'โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ'
                'ะคะะะะะข ะขะะะะะ ะะขะะะขะ:'
                '๐ง ะะะะขะะะ ะะะะฎะะ (3-5 ัััะพะบ):'
                '[ะกัะผะผะธััะน ัััั ะฒ ัะฐะผัั ะฒะฐะถะฝัั ะผะพะผะตะฝัะฐั]'
                '๐ ะขะะะะะฆะ ะะฆะะะะ:'
                '| ะญะบัะฟะตัั | ะะตัะพะด | ะะตะทัะปััะฐั | ะขะพัะฝะพััั | ะะพะผะผะตะฝัะฐัะธะน |'
                '|---------|-------|-----------|----------|------------|'
                '| ... | ... | ... | ...% | ... |'
                '๐ ะะะะะะะขะะะฌ:'
                'ะญะบัะฟะตัั: [ะะผั]'
                'ะัะธัะธะฝะฐ: [ะะพัะตะผั ะพะฝ ะฑัะป ะฟัะฐะฒ?]'
                'ะะปััะตะฒะฐั ะธะดะตั: [ะงัะพ ะพะฝ ะฟะพะฝัะป ะปัััะต ะดััะณะธั?]'
                '๐ญ ะกะะะขะะ ะะกะขะะะซ:'
                '[ะคะธะฝะฐะปัะฝัะน ะฟัะฐะฒะธะปัะฝัะน ะพัะฒะตั, ัะพะฑัะฐะฝะฝัะน ะธะท ะปัััะธั ะธะดะตะน ะฒัะตั ัะบัะฟะตััะพะฒ]'
                'โก ะะซะะะ:'
                '[1-2 ะฟัะตะดะปะพะถะตะฝะธั ะพ ัะพะผ, ััะพ ะฟัะพะธะทะพัะปะพ ะธ ะฟะพัะตะผั]'
                'โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ'
                'ะะะะะซะ ะะะะะะะ:'
                'โ๏ธ ะะฃะะฌ ะงะะกะขะะ:'
                '- ะัะธะทะฝะฐะฒะฐะน, ะตัะปะธ ัะบัะฟะตัั ะฑัะป ัะฐััะธัะฝะพ ะฟัะฐะฒ ะธะปะธ ะฟะพะปะฝะพัััั ะฝะตะฟัะฐะฒ'
                '- ะะต ัะฐะฒะพัะธัะธะทะธััะน ะฝะธะบะพะณะพ'
                'โ๏ธ ะะฃะะฌ ะกะะะะะะะะะ:'
                '- ะัะปะธ ะฝะตัะบะพะปัะบะพ ัะบัะฟะตััะพะฒ ะฟัะฐะฒั ะพะดะธะฝะฐะบะพะฒะพ ัะพัะพัะพ, ัะบะฐะถะธ ะพะฑ ััะพะผ'
                '- ะะฑัััะฝะธ, ะฟะพัะตะผั ะพะดะธะฝ ะฝะตะผะฝะพะณะพ ะปัััะต ะดััะณะธั'
                'โ๏ธ ะะฃะะฌ ะะะะขะะะ:'
                '- ะะตะทัะผะต ะดะพะปะถะฝะพ ะฑััั ััะฝัะผ ะธ ะบะพัะพัะบะธะผ'
                '- ะขะฐะฑะปะธัะฐ ะปัััะต ัะตะผ ะผะฝะพะณะพ ัะตะบััะฐ'
                'โ๏ธ ะคะะะฃะกะะะฃะะกะฏ ะะ ะะะะฃะะฌะขะะขะ:'
                '- ะะต ะฟัะพััะพ ััะฐะฒะฝะธะฒะฐะน, ะฐ ะฒัะดะตะปัะน, ะบัะพ ะฑัะป ะฑะปะธะถะต ะบ ะะกะขะะะ'
                '- ะะฑัััะฝัะน ะะะงะะะฃ ะตะณะพ ะฟะพะดัะพะด ัะฐะฑะพัะฐะป'
                'โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ'
                'ะะะะะ:'
                '- ะัะพัะตััะพั ะะผะตะณะฐ: ัะพัะผะฐะปะธะทะฐัะธั ะธ ะผะฐัะตะผะฐัะธะบะฐ (ะดะพะปะถะตะฝ ะฑััั ะพัะตะฝั ัะพัะตะฝ)'
                '- ะะพะบัะพั ะะปะณะพัะธัะผะธัั: ะณัะฐั ะธ ะปะพะณะธะบะฐ (ะบะพะผะฟะปะตะบัะฝัะน ะฟะพะดัะพะด)'
                '- ะะตัะตะบัะธะฒ ะะพะทะปะพะฒ: ะฟะพะธัะบ ะฟัะพัะธะฒะพัะตัะธะน (ะปะพะฒะธั ะพัะธะฑะบะธ)'
                '- ะัะธัะธะบ ะะพะฒะฐ: ะฒะฐะปะธะดะฐัะธั (ะฟัะพะฒะตััะตั ะฒัะต ััะปะพะฒะธั)'
                '- ะะพะบัะพั ะฅะฐะพั: ัะฒะพััะตัะบะธะต ะฟะพะดัะพะดั (ะผะพะถะตั ะฝะฐะนัะธ ะฝะตััะฐะฝะดะฐััะฝะพะต)'
                'ะะฐะถะดัะน ะธะผะตะตั ัะฒะพั ััะฟะตััะธะปั. ะขะฒะพั ะทะฐะดะฐัะฐ - ะฝะฐะนัะธ, ะบัะพ ะธัะฟะพะปัะทะพะฒะฐะป ัะฒะพั ััะฟะตััะธะปั ะปัััะต ะฒัะตะณะพ.'
                'โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ'
            ),
            max_tokens=None,
        )

        messages: list[BaseMessage] = [
            SystemMessage(agent.system_prompt),
            HumanMessage(f"ะะฐะดะฐะฝะฝัะน ะฒะพะฟัะพั:{self.message_user}")
        ]
        for response_agents in list_response:
            messages.append(AIMessage(response_agents))

        final_response = get_ai_manager().invoke(
            agent=agent,
            input_messages=messages,
            config=None,
            stop=None,
        )

        content = final_response.content if isinstance(final_response.content, str) else str(final_response.content)

        return (
            f"{'#' * 60}\n๐ญ {agent.name}, temperature={agent.temperature}, {agent.temperature}\n{'#' * 60}\n{content}\n\n"
        )
